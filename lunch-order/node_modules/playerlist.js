var jsutil = require('jsutil');
var playerlist = function(){};

var names = {};
var ids = {};
var accounts = {};

var names_online = {};
var ids_online = {};
var accounts_online = {};

var waitforclear = {};

function prepare(region){
	if (!names[region])
		names[region] = {};

	if (!ids[region])
		ids[region] = {};

	if (!accounts[region])
		accounts[region] = {};

	if (!names_online[region])
		names_online[region] = {};

	if (!ids_online[region])
		ids_online[region] = {};

	if (!accounts_online[region])
		accounts_online[region] = {};
}

playerlist.insert_total = function(region, name, id, account){
	prepare(region);
	
	names[region][name] = [id, account];
	ids[region][id] = [name, account];
	accounts[region][account] = [id, name];
}

playerlist.insert_online = function(region, name, id, account){
	prepare(region);
	
	names_online[region][name] = [id, account];
	ids_online[region][id] = [name, account];
	accounts_online[region][account] = [id, name];
}

playerlist.insert = function(region, name, id, account){
	if (waitforclear[region]){
		names_online[region] = {};
		ids_online[region] = {};
		accounts_online[region] = {};
	}
	waitforclear[region] = false;
	playerlist.insert_total(region, name, id, account);
	playerlist.insert_online(region, name, id, account);
}

playerlist.remove_by_name = function(region, name){
	var o = playerlist.find_by_name_online(region, name);
	if (o){
		jsutil.debug('remove:' + name);
		delete names_online[region][name];
		delete ids_online[region][o[0]];
		delete accounts_online[region][o[1]];
	}
}

playerlist.search_by_name = function(region, name){
	var result = [];
	prepare(region);
	for (var key in names[region]){
		if (name == "*" || key.toLowerCase().indexOf(name.toLowerCase()) >= 0){
			result.push(key);
		}
	}
	return result;
}

playerlist.search_by_name_online = function(region, name){
	var result = [];
	prepare(region);
	for (var key in names_online[region]){
		if (name == "*" || key.toLowerCase().indexOf(name.toLowerCase()) >= 0){
			result.push(key);
		}
	}
	jsutil.debug('search online');
	return result;
}

playerlist.find_by_name = function(region, name){
	prepare(region);
	return names[region][name];
}

playerlist.find_by_name_online = function(region, name){
	prepare(region);
	return names_online[region][name];
}

playerlist.find_by_id = function(region, id){
	prepare(region);
	return ids[region][id];
}

playerlist.find_by_account = function(region, account){
	prepare(region);
	return accounts[region][account];
}

playerlist.clear = function(region){
	waitforclear[region] = true;
}

module.exports = playerlist;